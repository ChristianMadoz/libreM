services:
  - name: frontend
    build: echo "Building in start script to ensure persistence"
    start: npm install --legacy-peer-deps && CI=false npm run build && npx serve -l 3000
    path: ./frontend
    port: 3000

  - name: backend
    build: pip install -r requirements.txt
    start: uvicorn server:app --host 0.0.0.0 --port 8000 || python -m http.server 8000
    path: ./backend
    port: 8000
routes:
  - path: /api
    service: backend
  - path: /
    service: frontend
